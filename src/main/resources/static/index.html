
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">

    <title>Starter Template for Bootstrap</title>

    <!-- Bootstrap core CSS -->
    <link href="./bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <style>
        body {
            padding-top: 50px;
        }
        .starter-template {
            padding: 40px 15px;
            text-align: center;
        }
        .popover{
            max-width: 100%; /* Max Width of the popover (depending on the container!) */
        }
    </style>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script src="./bower_components/jquery/dist/jquery.min.js"></script>
    <script>
        $(document).ready(function() {
            $(function () {
                $('#webhookPopoverId').popover({
                    container: 'body'
                });
                $('#webhookPopoverId2').popover({
                    container: 'body'
                });
            });

            var clicked = 'normal';
            $('#myTabs a').click(function (e) {
                e.preventDefault();
                $(this).tab('show');
                clicked = e.currentTarget.id;
            });

            $('#sendBtn').click(function (e) {
                clickSendBtn();
            });
            function clickSendBtn() {
                var offset = new Date().getTimezoneOffset();
                var radio = $(':radio[name="inlineRadioOptions"]:checked').val();
                var radioBool = radio == "Y";

                var orgVal = $("#sendTime").val();
                var temp = Date.parse(orgVal);

                var d = new Date(temp + offset*60*1000);

                var obj = {
                    webhookUrl : $("#webhookUrl").val(),
                    username : $("#username").val(),
                    channel : $("#channel").val(),
                    sendDate: d,
                    mrkdwn :  radioBool
                };

                var url = '';
                if(clicked == 'attachments-tab') {
                    url = "/sendSlackMessageAttachment";
                    var attachment = {
                        fallback: $('#fallback').val(),
                        color: $('#color').val(),
                        pretext: $('#pretext').val(),
                        author_name: $('#author_name').val(),
                        author_link: $('#author_link').val(),
                        author_icon: $('#author_icon').val(),
                        title: $('#title').val(),
                        title_link: $('#title_link').val(),
                        text: $('#text').val(),
                        image_url: $('#image_url').val(),
                        thumb_url: $('#thumb_url').val(),
                        footer: $('#footer').val(),
                        footer_icon: $('#footer_icon').val()
                    };

                    obj.attachments = [];
                    obj.attachments.push(attachment);

                    obj.validate = function() {
                        return obj.webhookUrl && obj.channel
                                && attachment.pretext
                                && attachment.title
                                && attachment.text;
                    }
                } else {
                    url = "/sendSlackMessage";
                    obj.text = $("#message").val();
                    obj.validate = function() {
                        return obj.webhookUrl && obj.channel && obj.text;
                    }
                }

                if(obj.validate()) {
                    jQuery.ajax({
                        type:"POST",
                        url: url,
                        contentType: "application/json; charset=UTF-8",
                        data: JSON.stringify(obj),
                        success : function(data) {
                            alert("메시지 전송완료");
                            $("#message").val('')
                        },
                        complete : function(data) {
                        },
                        error : function(xhr, status, error) {
                            alert("메시지 전송실패 : " + status);
                        }
                    });
                } else {
                    alert("need Data");
                }
            }
        });
    </script>
</head>

<body>
<div>
    <nav class="navbar navbar-inverse navbar-fixed-top">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#">My Slack Alarm Bot</a>
            </div>
            <div id="navbar" class="collapse navbar-collapse">
                <ul class="nav navbar-nav">
                    <li class="active"><a href="#">Test Page</a></li>
                    <li><a href="#about">준비1</a></li>
                    <li><a href="#contact">준비2</a></li>
                </ul>
            </div><!--/.nav-collapse -->
        </div>
    </nav>
</div>


<div class="container">

    <div class="starter-template">
        <h1>My Slack Message Test</h1>
        <p class="lead">슬랙으로 메시지를 보내세요</p>

        <ul class="nav nav-tabs" id="myTabs" role="tablist">
            <li role="presentation" class="active">
                <a href="#normal" id="normal-tab" role="tab" data-toggle="tab" aria-controls="normal" aria-expanded="true">Normal</a>
            </li>
            <li role="presentation" class="">
                <a href="#attachments" role="tab" id="attachments-tab" data-toggle="tab" aria-controls="attachments" aria-expanded="false">Attachments</a>
            </li>
        </ul>

        <div class="text-center center-block col-sm-12" style="margin-top: 10px">
            <form class="form-horizontal">
                <div class="form-group">
                    <label for="webhookUrl" class="col-sm-2 control-label">
                        WebHook URL
                        <button type="button" id="webhookPopoverId" class="btn btn-xs btn-info" data-toggle="popover" title="Webhook url?" data-content="To see https://{youdomain}.slack.com/apps/new/A0F7XDUAZ-incoming-webhooks">i</button>
                    </label>
                    <div class="col-sm-10">
                        <input type="url" class="form-control" id="webhookUrl" placeholder="https://hooks.slack.com/services/xxxx/xxxx/xxx">
                    </div>
                </div>

                <div class="form-group">
                    <label for="username" class="col-sm-2 control-label">Sender(NickName)</label>
                    <div class="col-sm-10">
                        <input class="form-control" id="username" placeholder="user name">
                    </div>
                </div>

                <div class="form-group">
                    <label for="channel" class="col-sm-2 control-label">Channel</label>
                    <div class="col-sm-10">
                        <input class="form-control" id="channel" placeholder="#general">
                    </div>
                </div>
                <div class="form-group">
                    <label for="sendTime" class="col-sm-2 control-label">SendTime</label>
                    <div class="col-sm-10">
                        <input type="datetime-local" id="sendTime">
                    </div>
                </div>

                <div class="form-group">
                    <label for="inlineRadio1" class="col-sm-2 control-label">MarkDown</label>
                    <div class="col-sm-10 text-left">
                        <label class="radio-inline">
                            <input type="radio" name="inlineRadioOptions" id="inlineRadio1" checked value="Y"> Enable
                        </label>
                        <label class="radio-inline">
                            <input type="radio" name="inlineRadioOptions" id="inlineRadio2" value="N"> Disable
                        </label>
                    </div>

                </div>
            </form>
        </div>

        <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade active in" role="tabpanel" id="normal" aria-labelledby="normal-tab">
                <div class="text-center center-block col-sm-12">
                    <form class="form-horizontal">
                        <div class="form-group">
                            <label for="message" class="col-sm-2 control-label">Message</label>
                            <div class="col-sm-10">
                                <textarea id="message" class="form-control" rows="3"></textarea>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <div class="tab-pane fade" role="tabpanel" id="attachments" aria-labelledby="attachments-tab">
                <div class="text-center center-block col-sm-12">
                    <form class="form-horizontal">
                        <div class="form-group">
                            <label for="color" class="col-sm-2 control-label">Color</label>
                            <div class="col-sm-10">
                                <input class="form-control" id="color" placeholder="">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="pretext" class="col-sm-2 control-label">PreText</label>
                            <div class="col-sm-10">
                                <input class="form-control" id="pretext" placeholder="">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="author_name" class="col-sm-2 control-label">Author Name</label>
                            <div class="col-sm-10">
                                <input class="form-control" id="author_name" placeholder="">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="author_link" class="col-sm-2 control-label">Author Link</label>
                            <div class="col-sm-10">
                                <input class="form-control" id="author_link" placeholder="">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="author_icon" class="col-sm-2 control-label">Author Icon</label>
                            <div class="col-sm-10">
                                <input class="form-control" id="author_icon" placeholder="">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="title" class="col-sm-2 control-label">Title</label>
                            <div class="col-sm-10">
                                <input class="form-control" id="title" placeholder="">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="text" class="col-sm-2 control-label">Text</label>
                            <div class="col-sm-10">
                                <input class="form-control" id="text" placeholder="">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="image_url" class="col-sm-2 control-label">Image Url</label>
                            <div class="col-sm-10">
                                <input class="form-control" id="image_url" placeholder="">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="thumb_url" class="col-sm-2 control-label">Thumb Url</label>
                            <div class="col-sm-10">
                                <input class="form-control" id="thumb_url" placeholder="">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="footer" class="col-sm-2 control-label">Footer</label>
                            <div class="col-sm-10">
                                <input class="form-control" id="footer" placeholder="">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="footer_icon" class="col-sm-2 control-label">Footer Icon</label>
                            <div class="col-sm-10">
                                <input class="form-control" id="footer_icon" placeholder="">
                            </div>
                        </div>
                    </form>
                    <!--val fallback: String,-->
                    <!--val author_name: String,-->
                    <!--val author_link: String,-->
                    <!--val author_icon: String,-->
                    <!--val title: String,-->
                    <!--val title_link: String,-->
                    <!--val text: String,-->
                    <!--val image_url: String,-->
                    <!--val thumb_url: String,-->
                    <!--val footer: String,-->
                    <!--val footer_icon: String,-->
                    <!--val ts: Long,-->
                    <!--val fields: List<AttachmentSlackPostField>-->
                </div>
            </div>
        </div>
        <div class="form-group">
            <div class="">
                <button type="button" id="sendBtn" class="btn btn-default">Send Message</button>
            </div>
        </div>

    </div>

</div><!-- /.container -->


<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->

<script src="./bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="./bower_components/bootstrap/js/tooltip.js"></script>
<script src="./bower_components/bootstrap/js/popover.js"></script>
<script src="./bower_components/bootstrap/js/tab.js"></script>
</body>
</html>
